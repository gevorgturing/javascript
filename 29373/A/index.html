<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BTC Price Tracker</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.css">
    <style>
        body { font-family: Arial, sans-serif; }
        #currentPrice { font-size: 2em; }
        .container { max-width: 1200px; margin: auto; padding: 20px; }
        .chart-container { width: 100%; height: 400px; }
        .order-form, .order-list { margin-top: 20px; }
    </style>
</head>
<body>
<div class="container">
    <h1>Real-Time BTC Price Tracker</h1>
    <div id="currentPrice">$<span id="price">0</span></div>
    <div class="chart-container">
        <canvas id="btcChart"></canvas>
    </div>
    <div class="order-form">
        <input type="number" id="buyPrice" placeholder="Price to Buy">
        <input type="number" id="buyAmount" placeholder="Amount in $">
        <button onclick="placeOrder()">Place Buy Order</button>
    </div>
    <div class="order-list">
        <h3>Your Orders</h3>
        <ul id="orderList"></ul>
    </div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.js"></script>
<script>
    let btcPrice = 0;
    let priceHistory = JSON.parse(localStorage.getItem('priceHistory') || '[]').slice(-100);
    let userBalance = parseFloat(localStorage.getItem('userBalance')) || 10000;
    let userBTC = parseFloat(localStorage.getItem('userBTC')) || 0;
    let orders = JSON.parse(localStorage.getItem('orders')) || [];

    function generatePrice() {
        const min = 16000, max = 68000;
        if (btcPrice === 0) btcPrice = Math.random() * (max - min) + min;
        else {
            let changePercent = 2 * (Math.random() - 0.5) * 0.1; // Up to 10% change
            btcPrice *= (1 + changePercent);
            btcPrice = Math.max(min, Math.min(max, btcPrice)); // Clamp the price
        }
        priceHistory.push({x: new Date(), y: btcPrice});
        if (priceHistory.length > 100) priceHistory.shift();
        localStorage.setItem('priceHistory', JSON.stringify(priceHistory));
        updateDisplay();
    }

    function updateDisplay() {
        document.getElementById('price').textContent = btcPrice.toFixed(2);
        updateChart();
        checkOrders();
    }

    function placeOrder() {
        const price = parseFloat(document.getElementById('buyPrice').value);
        const amount = parseFloat(document.getElementById('buyAmount').value);
        if (price > 0 && amount > 0 && amount <= userBalance) {
            orders.push({price, amount, btc: 0, id: Date.now()});
            userBalance -= amount;
            localStorage.setItem('userBalance', userBalance);
            localStorage.setItem('orders', JSON.stringify(orders));
            updateOrderList();
        } else {
            alert('Invalid order or insufficient funds.');
        }
    }

    function checkOrders() {
        orders.forEach((order, index) => {
            if ((btcPrice <= order.price && order.btc === 0) || (btcPrice >= order.price && order.btc > 0)) {
                const transactionAmount = order.btc === 0 ? order.amount : order.btc * btcPrice;
                userBalance += (order.btc === 0) ? -transactionAmount : transactionAmount;
                userBTC += (order.btc === 0) ? (order.amount / order.price) : -order.btc;
                orders.splice(index, 1);
            }
        });
        localStorage.setItem('userBalance', userBalance);
        localStorage.setItem('userBTC', userBTC);
        localStorage.setItem('orders', JSON.stringify(orders));
        updateOrderList();
    }

    function updateOrderList() {
        const list = document.getElementById('orderList');
        list.innerHTML = '';
        orders.forEach(order => {
            const li = document.createElement('li');
            li.textContent = `Buy at ${order.price} for $${order.amount} (ID: ${order.id})`;
            const cancelBtn = document.createElement('button');
            cancelBtn.textContent = 'Cancel';
            cancelBtn.onclick = () => cancelOrder(order.id);
            li.appendChild(cancelBtn);
            list.appendChild(li);
        });
    }

    function cancelOrder(id) {
        const index = orders.findIndex(o => o.id === id);
        if (index > -1) {
            userBalance += orders[index].amount;
            orders.splice(index, 1);
            localStorage.setItem('userBalance', userBalance);
            localStorage.setItem('orders', JSON.stringify(orders));
            updateOrderList();
        }
    }

    let chartInstance;
    function updateChart() {
        if (chartInstance) chartInstance.destroy();
        const ctx = document.getElementById('btcChart').getContext('2d');
        chartInstance = new Chart(ctx, {
            type: 'line',
            data: {
                datasets: [{
                    label: 'BTC Price',
                    data: priceHistory,
                    borderColor: 'rgba(75, 192, 192, 1)',
                    fill: false
                }]
            },
            options: {
                scales: {
                    xAxes: [{
                        type: 'time',
                        time: {
                            displayFormats: {
                                quarter: 'MMM YYYY'
                            }
                        }
                    }]
                },
                responsive: true,
                maintainAspectRatio: false,
                tooltips: {
                    mode: 'index',
                    intersect: false
                }
            }
        });
    }

    // Initial setup
    updateOrderList();
    setInterval(generatePrice, 10000);
    generatePrice();
</script>
</body>
</html>