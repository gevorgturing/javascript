<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Magic Square Challenge</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css">
<style>
    input[type="number"] {
        width: 100px;
        height: 100px;
        text-align: center;
        font-size: 50px;
        font-weight: bold;
    }
    .sum-display {
        width: 100px;
        height: 100px;
        text-align: center;
        font-size: 25px;
        font-weight: bold;
        background-color: lightgray;
        line-height: 100px;
    }
    #answerButton {
        display: none;
    }
</style>
</head>
<body>
<div class="container">
    <h2 class="text-center">Enter numbers from 1 to 9 such that the sum in all directions is the same.</h2>
    <table class="table table-bordered mx-auto">
        <tbody id="magicSquare">
            <!-- Table rows will be dynamically generated -->
        </tbody>
        <tfoot>
            <tr id="sumsRow"></tr>
        </tfoot>
    </table>
    <button id="resetButton" class="btn btn-danger">Reset Table</button>
    <button id="answerButton" class="btn btn-success">Show Correct Answer</button>
</div>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script>
    let correctAnswer = [8, 1, 6, 3, 5, 7, 4, 9, 2];
    $(document).ready(function() {
        const size = 3;
        const localKey = 'magicSquareValues';
        const answerDelay = 30000;

        function createTable() {
            for (let i = 0; i < size; i++) {
                let row = '<tr>';
                for (let j = 0; j < size; j++) {
                    row += `<td><input type="number" class="form-control" pattern="[1-9]{1}" required></td>`;
                }
                row += '<td class="sum-display"></td></tr>';
                $('#magicSquare').append(row);
            }
            for (let i = 0; i < size; i++) {
                $('#sumsRow').append('<td class="sum-display" id="colSum' + i + '"></td>');
            }
            $('#sumsRow').append('<td class="sum-display" id="diagSum1"></td><td class="sum-display" id="diagSum2"></td>');
        }

        function loadFromStorage() {
            const storedValues = JSON.parse(localStorage.getItem(localKey) || '{}');
            $('input[type="number"]').each(function(index) {
                $(this).val(storedValues[index] || '');
            });
        }

        function saveToStorage() {
            const values = $('input[type="number"]').map(function() {
                return $(this).val();
            }).get();
            localStorage.setItem(localKey, JSON.stringify(values));
        }

        function calculateSums() {
            const inputs = $('input[type="number"]').map(function() {
                return parseInt($(this).val()) || 0;
            }).get();

            for (let i = 0; i < size; i++) {
                let rowSum = 0, colSum = 0;
                for (let j = 0; j < size; j++) {
                    rowSum += inputs[i * size + j];
                    colSum += inputs[j * size + i];
                }
                $(`tr:eq(${i}) td.sum-display`).text(rowSum);
                $('#colSum' + i).text(colSum);
            }

            let diagSum1 = 0, diagSum2 = 0;
            for (let i = 0; i < size; i++) {
                diagSum1 += inputs[i * size + i];
                diagSum2 += inputs[i * size + (size - i - 1)];
            }
            $('#diagSum1').text(diagSum1);
            $('#diagSum2').text(diagSum2);
        }

        function resetTable() {
            $('input[type="number"]').val('');
            localStorage.removeItem(localKey);
            calculateSums();
        }


        createTable();
        loadFromStorage();
        calculateSums();

        $('input[type="number"]').on('input', function() {
            saveToStorage();
            calculateSums();
        });

        $('#resetButton').on('click', resetTable);

        setTimeout(function() {
            $('#answerButton').show();
            $('#answerButton').click(function() {
                debugger
                $('input[type="number"]').each(function(index) {
                    $(this).val(correctAnswer[index]);
                });
                debugger
                calculateSums();
            });
        }, answerDelay);
    });
</script>
</body>
</html>