<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Magic Square Puzzle</title>
<style>
    body { font-family: Arial, sans-serif; max-width: 600px; margin: auto; padding: 10px; }
    .instruction { margin-bottom: 20px; text-align: center; }
    .grid { display: grid; grid-template-columns: repeat(3, 100px); gap: 5px; margin: 20px auto; }
    .grid input, .sum { width: 100px; height: 100px; font-size: 50px; text-align: center; font-weight: bold; border: 2px solid #ccc; }
    .sum { background-color: #f0f0f0; line-height: 100px; }
    button { display: block; margin: 10px auto; padding: 10px 20px; }
    @media (max-width: 480px) {
        .grid { grid-template-columns: repeat(3, 30vw); }
        .grid input, .sum { width: 30vw; height: 30vw; font-size: 10vw; }
        .sum { line-height: 30vw; }
    }
</style>
</head>
<body>

<div class="instruction">Enter numbers 1-9 such that each row, column, and diagonal sums to the same value.</div>
<div class="grid" id="magicSquare"></div>
<div id="sumsDisplay"></div>
<button onclick="resetGrid()">Reset Grid</button>
<button id="showSolution" style="display:none;" onclick="showCorrectAnswer()">Show Correct Answer</button>

<script>
    const grid = document.getElementById('magicSquare');
    const sumsDisplay = document.getElementById('sumsDisplay');
    const showSolutionButton = document.getElementById('showSolution');
    const regex = /^[1-9]$/;
    const solution = [8, 1, 6, 3, 5, 7, 4, 9, 2]; // A correct solution for reference

    function createGrid() {
        for(let i = 0; i < 9; i++) {
            let input = document.createElement('input');
            input.type = 'text';
            input.maxLength = 1;
            input.pattern = '[1-9]';
            input.oninput = function() {
                if (regex.test(this.value)) saveToLocalStorage(i, this.value);
            };
            grid.appendChild(input);
        }
        loadFromLocalStorage();
    }

    function saveToLocalStorage(index, value) {
        localStorage.setItem(`cell${index}`, value);
        calculateSums();
    }

    function loadFromLocalStorage() {
        for(let i = 0; i < 9; i++) {
            let value = localStorage.getItem(`cell${i}`) || '';
            grid.children[i].value = value;
        }
        calculateSums();
    }

    function calculateSums() {
        let cells = Array.from(grid.children).map(e => parseInt(e.value) || 0);
        let sums = [];
        // Rows, Columns, Diagonals
        for (let i = 0; i < 3; i++) {
            sums.push(cells[i*3] + cells[i*3+1] + cells[i*3+2]); // Rows
            sums.push(cells[i] + cells[i+3] + cells[i+6]); // Columns
        }
        sums.push(cells[0] + cells[4] + cells[8]); // Main diagonal
        sums.push(cells[2] + cells[4] + cells[6]); // Other diagonal

        displaySums(sums);
    }

    function displaySums(sums) {
        sumsDisplay.innerHTML = '';
        sums.forEach(sum => {
            let div = document.createElement('div');
            div.className = 'sum';
            div.textContent = sum;
            sumsDisplay.appendChild(div);
        });
    }

    function resetGrid() {
        localStorage.clear();
        Array.from(grid.children).forEach(child => child.value = '');
        sumsDisplay.innerHTML = '';
    }

    function showCorrectAnswer() {
        let inputs = Array.from(grid.children);
        inputs.forEach((input, index) => input.value = solution[index]);
        calculateSums();
    }

    // Initialize grid and show solution button after 30 seconds
    createGrid();
    setTimeout(() => showSolutionButton.style.display = 'block', 30000);
</script>

</body>
</html>