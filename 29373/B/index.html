<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Real-Time Crypto Price Tracker</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
<style>
    body { font-family: 'Arial', sans-serif; padding: 20px; }
    #priceDisplay { font-size: 2em; margin: 20px 0; }
    #chartContainer { width: 100%; height: 400px; }
    .order-form, .order-list { margin-top: 20px; }
</style>
</head>
<body>

<div class="container">
    <h1>BTC Price Tracker</h1>
    <div id="priceDisplay">$0.00</div>
    <div id="balanceDisplay">Balance: $10,000</div>
    <div id="btcBalanceDisplay">BTC: 0.000000</div>
    <div id="chartContainer">
        <canvas id="btcChart"></canvas>
    </div>
    <div class="row">
        <div class="col-md-6 order-form">
            <h2>Place Order</h2>
            <input type="number" id="orderPrice" placeholder="Price" min="16000" max="68000" step="1">
            <input type="number" id="orderAmount" placeholder="Amount in USD" min="1">
            <button onclick="placeOrder()">Place Order</button>
        </div>
        <div class="col-md-6 order-list">
            <h2>Your Orders</h2>
            <ul id="ordersList"></ul>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@1.1.1/dist/chartjs-plugin-zoom.min.js"></script>
<script>
let currentPrice = 0;
let prices = [];
let balance = localStorage.getItem('balance') || 10000;
let btcBalance = localStorage.getItem('btcBalance') || 0;
let orders = JSON.parse(localStorage.getItem('orders')) || [];

function generatePrice() {
    if (!currentPrice) {
        currentPrice = Math.floor(Math.random() * (68000 - 16000 + 1)) + 16000;
    } else {
        let changePercent = 10; // max change of 10%
        let changeAmount = currentPrice * (Math.random() * changePercent / 100);
        currentPrice += Math.random() > 0.5 ? changeAmount : -changeAmount;
        currentPrice = Math.max(16000, Math.min(68000, currentPrice));
    }
    prices.push(currentPrice);
    if (prices.length > 100) prices.shift();
    localStorage.setItem('prices', JSON.stringify(prices));
    updateDisplay();
    checkOrders();
}

function updateDisplay() {
    document.getElementById('priceDisplay').textContent = `$${currentPrice.toFixed(2)}`;
    document.getElementById('balanceDisplay').textContent = `Balance: $${balance.toFixed(2)}`;
    document.getElementById('btcBalanceDisplay').textContent = `BTC: ${btcBalance.toFixed(6)}`;
    updateChart();
}

function updateChart() {
    const ctx = document.getElementById('btcChart').getContext('2d');
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: prices.map((_, i) => i),
            datasets: [{
                label: 'BTC Price',
                data: prices,
                borderColor: 'rgb(75, 192, 192)',
                tension: 0.1
            }]
        },
        options: {
            plugins: {
                zoom: {
                    zoom: {
                        wheel: { enabled: true },
                        pinch: { enabled: true },
                        mode: 'xy',
                    }
                }
            }
        }
    });
}

function placeOrder() {
    const price = parseFloat(document.getElementById('orderPrice').value);
    const amount = parseFloat(document.getElementById('orderAmount').value);
    if (balance >= amount && price && amount > 0) {
        balance -= amount;
        orders.push({price, amount, type: 'buy', id: Date.now()});
        localStorage.setItem('orders', JSON.stringify(orders));
        localStorage.setItem('balance', balance);
        updateDisplay();
        updateOrdersList();
    }
}

function checkOrders() {
    orders = orders.filter(order => {
        if ((order.type === 'buy' && currentPrice <= order.price) ||
            (order.type === 'sell' && currentPrice >= order.price)) {
            if (order.type === 'buy') {
                const btcBought = order.amount / currentPrice;
                btcBalance += btcBought;
                balance += order.amount - (btcBought * currentPrice);
            } else {
                balance += currentPrice * order.amount;
                btcBalance -= order.amount;
            }
            return false; // Remove executed order
        }
        return true; // Keep the order
    });
    localStorage.setItem('orders', JSON.stringify(orders));
    localStorage.setItem('balance', balance);
    localStorage.setItem('btcBalance', btcBalance);
    updateDisplay();
    updateOrdersList();
}

function updateOrdersList() {
    const list = document.getElementById('ordersList');
    list.innerHTML = '';
    orders.forEach(order => {
        const li = document.createElement('li');
        li.textContent = `${order.type === 'buy' ? 'Buy' : 'Sell'} at $${order.price} for $${order.amount}`;
        const cancelBtn = document.createElement('button');
        cancelBtn.textContent = 'Cancel';
        cancelBtn.onclick = () => cancelOrder(order.id);
        li.appendChild(cancelBtn);
        list.appendChild(li);
    });
}

function cancelOrder(id) {
    const index = orders.findIndex(o => o.id === id);
    if (index > -1) {
        const order = orders.splice(index, 1)[0];
        if (order.type === 'buy') balance += order.amount;
        localStorage.setItem('balance', balance);
        localStorage.setItem('orders', JSON.stringify(orders));
        updateDisplay();
        updateOrdersList();
    }
}

// Initial setup
if (localStorage.getItem('prices')) {
    prices = JSON.parse(localStorage.getItem('prices'));
    currentPrice = prices[prices.length - 1];
}

setInterval(generatePrice, 10000);
updateDisplay();
updateOrdersList();
generatePrice(); // Start immediately
</script>
</body>
</html>