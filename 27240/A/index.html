<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mathematical Logic Challenge</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
<style>
  .input-cell {
    width: 100px;
    height: 100px;
    text-align: center;
    font-size: 50px;
    font-weight: bold;
  }
  .sum-cell {
    width: 100px;
    height: 100px;
    background-color: #f0f0f0;
    text-align: center;
    font-size: 20px;
  }
  #reset-button, #solution-button {
    display: block;
    margin: 20px auto;
  }
  #instruction {
    text-align: center;
    margin-bottom: 20px;
  }
</style>
</head>
<body>
<div id="instruction">
  <h2>Enter numbers from 1 to 9 such that the sum in all directions is the same.</h2>
</div>
<table id="logic-table">
  <tbody>
    <tr><td><input type="text" class="input-cell" maxlength="1" pattern="[1-9]"></td><td><input type="text" class="input-cell" maxlength="1" pattern="[1-9]"></td><td><input type="text" class="input-cell" maxlength="1" pattern="[1-9]"></td></tr>
    <tr><td><input type="text" class="input-cell" maxlength="1" pattern="[1-9]"></td><td><input type="text" class="input-cell" maxlength="1" pattern="[1-9]"></td><td><input type="text" class="input-cell" maxlength="1" pattern="[1-9]"></td></tr>
    <tr><td><input type="text" class="input-cell" maxlength="1" pattern="[1-9]"></td><td><input type="text" class="input-cell" maxlength="1" pattern="[1-9]"></td><td><input type="text" class="input-cell" maxlength="1" pattern="[1-9]"></td></tr>
  </tbody>
</table>
<button id="reset-button" class="btn btn-danger">Reset Table</button>
<button id="solution-button" class="btn btn-success" style="display: none;">Show Solution</button>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
  $(document).ready(function() {
    // Initialize table from local storage
    for (let i = 0; i < 9; i++) {
      let storedValue = localStorage.getItem('cell' + i);
      if (storedValue) {
        $('#logic-table input:eq(' + i + ')').val(storedValue);
      }
    }

    $('#logic-table input').on('input', function() {
      let index = $(this).closest('td').index() + $(this).closest('tr').index() * 3;
      localStorage.setItem('cell' + index, $(this).val());
    });

    $('#reset-button').on('click', function() {
      localStorage.clear();
      $('#logic-table input').val('');
      $('#solution-button').hide();
      setTimeout(function() {
        $('#solution-button').show();
      }, 30000);
    });

    $('#solution-button').on('click', function() {
      let solution = [8, 1, 6, 3, 5, 7, 4, 9, 2];
      $('#logic-table input').each(function(index) {
        $(this).val(solution[index]);
      });
    });

    // Sum calculation
    function calculateSums() {
      let sums = {rows: [], cols: [], diags: []};
      for (let i = 0; i < 3; i++) {
        sums.rows[i] = sums.cols[i] = 0;
        for (let j = 0; j < 3; j++) {
          let val = parseInt($('#logic-table tr:eq(' + i + ') td:eq(' + j + ') input').val()) || 0;
          sums.rows[i] += val;
          sums.cols[j] += val;
        }
      }
      sums.diags[0] = sums.diags[1] = 0;
      for (let i = 0; i < 3; i++) {
        sums.diags[0] += parseInt($('#logic-table tr:eq(' + i + ') td:eq(' + i + ') input').val()) || 0;
        sums.diags[1] += parseInt($('#logic-table tr:eq(' + i + ') td:eq(' + (2 - i) + ') input').val()) || 0;
      }
      return sums;
    }

    function displaySums(sums) {
      let html = '';
      for (let i = 0; i < 3; i++) {
        html += '<td class="sum-cell">' + sums.rows[i] + '</td>';
      }
      $('#logic-table tr').each(function(index) {
        $(this).append(html);
      });

      for (let i = 0; i < 3; i++) {
        $('#logic-table').append('<tr><td class="sum-cell">' + sums.cols[i] + '</td></tr>');
      }
      $('#logic-table').append('<tr><td class="sum-cell">' + sums.diags[0] + '</td><td class="sum-cell">' + sums.diags[1] + '</td></tr>');
    }

    let sums = calculateSums();
    displaySums(sums);

    setTimeout(function() {
      $('#solution-button').show();
    }, 30000);
  });
</script>
</body>
</html>