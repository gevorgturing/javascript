<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CV Maker</title>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@^2.0/dist/tailwind.min.css" rel="stylesheet">
<style>
    .dark-mode {
        background-color: #333;
        color: #ccc;
    }
    .dark-mode input, .dark-mode textarea {
        background-color: #555;
        color: #ddd;
        border-color: #666;
    }
    .dark-mode button {
        background-color: #444;
        border-color: #555;
    }
</style>

</head>
<body class="bg-gray-100 text-gray-800">
<div class="container mx-auto px-4 py-4 shadow-lg max-w-4xl">
    <div class="flex flex-wrap justify-between mb-4">
        <button id="editButton" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline w-full md:w-auto mb-2 md:mb-0" onclick="editCV()" style="display: none;">Edit</button>
        <button id="previewButton" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline w-full md:w-auto mb-2 md:mb-0" type="button" onclick="previewCV()">Preview</button>
        <button class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline w-full md:w-auto mb-2 md:mb-0" type="button" onclick="resetForm()">Reset</button>
        <button class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline w-full md:w-auto mb-2 md:mb-0" type="button" onclick="downloadPDF()">Download PDF</button>
        <button class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline w-full md:w-auto" onclick="toggleMode()">Toggle Dark/Light Mode</button>
    </div>
    <form id="cvForm" class="mb-4">
        <!-- Input fields for CV information -->
        <div class="flex flex-wrap -mx-2">
            <div class="w-full md:w-1/2 px-2 mb-4">
                <input class="appearance-none block w-full bg-gray-200 text-gray-700 border border-gray-200 rounded py-3 px-4 leading-tight focus:outline-none focus:bg-white focus:border-gray-500" type="text" id="firstName" placeholder="First Name" required>
            </div>
            <div class="w-full md:w-1/2 px-2 mb-4">
                <input class="appearance-none block w-full bg-gray-200 text-gray-700 border border-gray-200 rounded py-3 px-4 leading-tight focus:outline-none focus:bg-white focus:border-gray-500" type="text" id="lastName" placeholder="Last Name" required>
            </div>
            <div class="w-full px-2 mb-4">
                <input class="appearance-none block w-full bg-gray-200 text-gray-700 border border-gray-200 rounded py-3 px-4 leading-tight focus:outline-none focus:bg-white focus:border-gray-500" type="email" id="email" placeholder="Email">
            </div>
            <div class="w-full px-2 mb-4">
                <input class="appearance-none block w-full bg-gray-200 text-gray-700 border border-gray-200 rounded py-3 px-4 leading-tight focus:outline-none focus:bg-white focus:border-gray-500" type="tel" id="phone" placeholder="Phone Number">
            </div>
            <div class="w-full px-2 mb-4">
                <input class="appearance-none block w-full bg-gray-200 text-gray-700 border border-gray-200 rounded py-3 px-4 leading-tight focus:outline-none focus:bg-white focus:border-gray-500" type="file" id="photo" accept="image/*">
            </div>
            <div class="w-full px-2 mb-4">
                <textarea class="appearance-none block w-full bg-gray-200 text-gray-700 border border-gray-200 rounded py-3 px-4 leading-tight focus:outline-none focus:bg-white focus:border-gray-500" id="summary" placeholder="Professional Summary"></textarea>
            </div>
            <div class="w-full px-2 mb-4">
                <textarea class="appearance-none block w-full bg-gray-200 text-gray-700 border border-gray-200 rounded py-3 px-4 leading-tight focus:outline-none focus:bg-white focus:border-gray-500" id="workHistory" placeholder="Work History"></textarea>
            </div>
            <div class="w-full px-2 mb-4">
                <textarea class="appearance-none block w-full bg-gray-200 text-gray-700 border border-gray-200 rounded py-3 px-4 leading-tight focus:outline-none focus:bg-white focus:border-gray-500" id="skills" placeholder="Skills"></textarea>
            </div>
            <div class="w-full px-2 mb-4">
                <textarea class="appearance-none block w-full bg-gray-200 text-gray-700 border border-gray-200 rounded py-3 px-4 leading-tight focus:outline-none focus:bg-white focus:border-gray-500" id="education" placeholder="Education"></textarea>
            </div>
        </div>
    </form>
    <div id="cvPreview" class="hidden p-4 border border-gray-300"></div>
</div>

<!-- Scripts for functionality -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.3.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.3.2/html2canvas.min.js"></script>
<script>
let isPreview = false;

function updateLocalStorage() {
    localStorage.setItem('cvData', JSON.stringify({
        firstName: document.getElementById('firstName').value,
        lastName: document.getElementById('lastName').value,
        email: document.getElementById('email').value,
        phone: document.getElementById('phone').value,
        summary: document.getElementById('summary').value,
        workHistory: document.getElementById('workHistory').value,
        skills: document.getElementById('skills').value,
        education: document.getElementById('education').value
    }));
}

function loadFromLocalStorage() {
    const data = JSON.parse(localStorage.getItem('cvData') || '{}');
    for (let key in data) {
        if (document.getElementById(key)) {
            document.getElementById(key).value = data[key];
        }
    }
}

function toggleMode() {
    const body = document.body;
    body.classList.toggle('dark-mode');
}

function previewCV() {
    if (!isPreview) {
        document.getElementById('cvForm').style.display = 'none';
        const preview = document.getElementById('cvPreview');
        preview.style.display = 'block';
        preview.innerHTML = generateCVHTML();
        document.getElementById('previewButton').style.display = 'none';
        document.getElementById('editButton').style.display = 'inline-block'; // Show Edit button
        isPreview = true;
    }
}

function editCV() {
    document.getElementById('cvForm').style.display = 'block';
    document.getElementById('cvPreview').style.display = 'none';
    document.getElementById('previewButton').style.display = 'inline-block';
    document.getElementById('editButton').style.display = 'none';
    isPreview = false;
}

function resetForm() {
    if (confirm("Are you sure?")) {
        localStorage.removeItem('cvData');
        document.getElementById('cvForm').reset();
        editCV();
    }
}



document.getElementById('cvForm').addEventListener('input', updateLocalStorage);
loadFromLocalStorage();

function previewCV() {
    generateCVHTML().then(html => {
        const preview = document.getElementById('cvPreview');
        preview.innerHTML = html;
        preview.style.display = 'block';
        document.getElementById('cvForm').style.display = 'none';
        document.getElementById('editButton').style.display = 'block';
        document.getElementById('previewButton').style.display = 'none';
    }).catch(error => {
        console.error('Error generating preview:', error);
    });
}

function editCV() {
    document.getElementById('cvForm').style.display = 'block';
    document.getElementById('cvPreview').style.display = 'none';
    document.getElementById('editButton').style.display = 'none';
    document.getElementById('previewButton').style.display = 'block';
}

function generateCVHTML() {
    return new Promise((resolve, reject) => {
        const beforePhotoFields = ['firstName', 'lastName', 'email'];
        const afterPhotoFields = ['summary', 'workHistory', 'skills', 'education'];
        let html = `
            <div style="text-align: center; font-family: Arial, sans-serif; width: 100%;">
            <style>
                h6 { font-size: 12px; }
                p { font-size: 14px; }
            </style>
        `;
        const firstName = document.getElementById('firstName').value;
        const lastName = document.getElementById('lastName').value;

        beforePhotoFields.forEach(field => {
            const value = document.getElementById(field).value;
            if (value) {
                html += `<h6>${field.charAt(0).toUpperCase() + field.slice(1)}</h6><p>${value.replace(/\n/g, '<br>')}</p>`;
            }
        });

        const fileInput = document.getElementById('photo');
        if (fileInput.files.length > 0) {
            const reader = new FileReader();
            reader.onload = function (e) {
                html += `<img src="${e.target.result}" class="photo-preview" style="width: 100px; height: auto; display: block; margin: 10px auto;">`;
                afterPhotoFields.forEach(field => {
                    const value = document.getElementById(field).value;
                    if (value) {
                        html += `<h6>${field.charAt(0).toUpperCase() + field.slice(1)}</h6><p>${value.replace(/\n/g, '<br>')}</p>`;
                    }
                });
                html += '</div>';
                resolve(html);
            };
            reader.onerror = reject;
            reader.readAsDataURL(fileInput.files[0]);
        } else {
            afterPhotoFields.forEach(field => {
                const value = document.getElementById(field).value;
                if (value) {
                    html += `<h6>${field.charAt(0).toUpperCase() + field.slice(1)}</h6><p>${value.replace(/\n/g, '<br>')}</p>`;
                }
            });
            html += '</div>';
            resolve(html);
        }
    });
}

function downloadPDF() {
    let tempDiv;
    generateCVHTML().then(html => {
        tempDiv = document.createElement('div');
        tempDiv.innerHTML = html;
        tempDiv.style.visibility = 'visible';
        tempDiv.style.position = 'absolute';
        tempDiv.style.left = '-9999px';
        document.body.appendChild(tempDiv);

        return html2canvas(tempDiv, {
            scale: 5,
            useCORS: true
        }).then(canvas => {
            if (canvas.height === 0) {
                alert('The CV content is empty. Please fill out the CV form before downloading.');
                return;
            }
            const imgData = canvas.toDataURL('image/png');
            const doc = new jspdf.jsPDF({
                orientation: 'portrait',
                unit: 'pt',
                format: 'a4'
            });

            const pageWidth = doc.internal.pageSize.getWidth();
            const pageHeight = doc.internal.pageSize.getHeight();
            const scale = Math.min(pageWidth / canvas.width, pageHeight / canvas.height);

            const canvasWidth = canvas.width * scale;
            const canvasHeight = canvas.height * scale;
            const marginX = (pageWidth - canvasWidth) / 2;

            doc.addImage(imgData, 'PNG', marginX, 0, canvasWidth, canvasHeight);
            doc.save('cv.pdf');
            document.body.removeChild(tempDiv);
        });
    }).catch(error => {
        console.error('Error in PDF creation:', error);
        if (tempDiv && tempDiv.parentNode) {
            document.body.removeChild(tempDiv);
        }
    });
}
</script>
</body>
</html>
